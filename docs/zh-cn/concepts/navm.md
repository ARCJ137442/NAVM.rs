# NAVM

[🔙概念](./doc.md)

[📃源码](./../../../src/vm/mod.rs)

📍最后更新：【2024-04-13 15:15:27】

📄全名：Non-Axiomatic Virtual Machine（非公理虚拟机）

🎯NARS在工程应用中的**中层抽象**

- ✅基本涵盖NARS的各版本[计算机实现](./cin.md)
- ✨统一的输入输出格式
  - 输入：[NAVM指令](./navm_cmd.md) `Cmd`
  - 输出：[NAVM输出](./navm_output.md) `Output`
- 📌使用「启动器→运行时」的API架构，将「启动配置」与「运行时状态」分离
  - 🔗从：[NAVM启动器](#启动器)
  - 🔗到：[NAVM运行时](#运行时)

## 启动器

[🔙NAVM](#navm)

[📃源码](./../../../src/vm/traits.rs)

- 🎯记录启动参数
  - 📄在基于JVM的CIN之启动器中，可附带与JVM有关的参数（如OpenNARS）
  - 📄在基于「独立可执行文件」的CIN之启动器中，将有与「可执行文件所在路径」有关的参数（如ONA）
- 🎯并自身作为「启动配置」启动虚拟机
  - 通过一个统一的`launch`方法，启动到[NAVM运行时](#运行时)

## 运行时

[🔙NAVM](#navm)

[📃源码](./../../../src/vm/traits.rs)

- 🎯记录并追踪虚拟机的运行时状态、输入输出
  - 📍「虚拟机状态」
    - [📃源码](./../../../src/vm/structs.rs)
    - 🎯指示虚拟机当前的运作情况：「正在运行」还是「已 停机/终止」
    - 📄目前存在两种主要状态
      - 正在运行
      - 已终止（附带「终止结果」）
  - 📍「虚拟机输入输出」
    - 🎯通过统一的「NAVM指令」与「NAVM输出」**尽可能**隐去各[CIN](./cin.md)的底层运作差异
    - ⚠️可以抹除在「不同Narsese方言」的差异，但**NAL、控制机制层面的差异不可避免**
      - 📄ONA：复合词项最多有两个子项；仅支持注册有限数目的操作
      - 📄PyNARS：截止至【2024-04-13 16:43:17】，尚未正式支持NAL 7~9
- 📌输入输出之间是**异步**的：**输入输出之顺序不能被完全确定**
  - 🚩输入：通过调用「输入指令」方法，向CIN置入一条「NAVM指令」
  - 🚩输出：通过调用「拉取输出」或「尝试拉取输出」方法，从CIN缓存的输出中拉取一个「NAVM输出」
  - ⚠️输入「NAVM指令」后不会立即返回输出（作为函数返回值等）
- ✨可被其创建者随时终止
  - ⚠️虚拟机终止后，输入输出将不再被处理
